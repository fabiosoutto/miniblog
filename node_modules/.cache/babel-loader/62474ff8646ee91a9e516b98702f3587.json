{"ast":null,"code":"import _regeneratorRuntime from\"C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/miniblog/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/miniblog/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/miniblog/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/miniblog/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from\"react\";import{db}from\"../firebase/config\";import{collection,query,orderBy,onSnapshot,where}from\"firebase/firestore\";export var useFetchDocuments=function useFetchDocuments(docCollection){var search=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var uid=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),documents=_useState2[0],setDocuments=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setloading=_useState6[1];// deal with memory leak\nvar _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),cancelled=_useState8[0],setCancelled=_useState8[1];useEffect(function(){function loadData(){return _loadData.apply(this,arguments);}function _loadData(){_loadData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var collectionRef,q;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!cancelled){_context.next=2;break;}return _context.abrupt(\"return\");case 2:setloading(true);_context.next=5;return collection(db,docCollection);case 5:collectionRef=_context.sent;_context.prev=6;if(!search){_context.next=13;break;}_context.next=10;return query(collectionRef,where(\"tagsArray\",\"array-contains\",search),orderBy(\"createdAt\",\"desc\"));case 10:q=_context.sent;_context.next=22;break;case 13:if(!uid){_context.next=19;break;}_context.next=16;return query(collectionRef,where(\"uid\",\"==\",uid),orderBy(\"createdAt\",\"desc\"));case 16:q=_context.sent;_context.next=22;break;case 19:_context.next=21;return query(collectionRef,orderBy(\"createdAt\",\"desc\"));case 21:q=_context.sent;case 22:_context.next=24;return onSnapshot(q,function(querySnapshot){setDocuments(querySnapshot.docs.map(function(doc){return _objectSpread({id:doc.id},doc.data());}));});case 24:setloading(false);_context.next=32;break;case 27:_context.prev=27;_context.t0=_context[\"catch\"](6);console.log(_context.t0);setError(_context.t0.message);setloading(false);case 32:case\"end\":return _context.stop();}}},_callee,null,[[6,27]]);}));return _loadData.apply(this,arguments);}loadData();},[docCollection,search,uid,cancelled]);useEffect(function(){return function(){return setCancelled(true);};},[]);return{documents:documents,loading:loading,error:error};};","map":{"version":3,"names":["useState","useEffect","db","collection","query","orderBy","onSnapshot","where","useFetchDocuments","docCollection","search","uid","documents","setDocuments","error","setError","loading","setloading","cancelled","setCancelled","loadData","collectionRef","q","querySnapshot","docs","map","doc","id","data","console","log","message"],"sources":["C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/miniblog/src/hooks/useFetchDocuments.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { db } from \"../firebase/config\";\r\nimport {\r\n    collection,\r\n    query,\r\n    orderBy,\r\n    onSnapshot,\r\n    where,\r\n} from \"firebase/firestore\";\r\n\r\n\r\nexport const useFetchDocuments = (docCollection, search = null, uid = null) => {\r\n\r\n    const [documents, setDocuments] = useState(null);\r\n    const [error, setError] = useState(null);\r\n    const [loading, setloading] = useState(null);\r\n\r\n\r\n    // deal with memory leak\r\n    const [cancelled, setCancelled] = useState(false);\r\n\r\n    useEffect(() => {\r\n\r\n        async function loadData() {\r\n            if(cancelled) return;\r\n\r\n            setloading(true);\r\n\r\n            const collectionRef = await collection(db, docCollection);\r\n\r\n            try {\r\n                let q;\r\n\r\n                \r\n                // Search\r\n                if(search) {\r\n                    q = await query(collectionRef, where(\"tagsArray\", \"array-contains\", search), orderBy(\"createdAt\", \"desc\")\r\n                    );\r\n                //Dashboard\r\n                } else if(uid) {\r\n                    q = await query(collectionRef, where(\"uid\", \"==\", uid), orderBy(\"createdAt\", \"desc\")\r\n                    );\r\n                } else {\r\n                    q = await query(collectionRef, orderBy(\"createdAt\", \"desc\"));\r\n                }\r\n\r\n                await onSnapshot(q, (querySnapshot) => {\r\n\r\n                    setDocuments(\r\n                        querySnapshot.docs.map((doc) => ({\r\n                            id: doc.id,\r\n                            ...doc.data(),\r\n                        }))\r\n                    );\r\n                });\r\n\r\n                setloading(false);\r\n            } catch (error) {\r\n                console.log(error);\r\n                setError(error.message);\r\n\r\n                setloading(false);\r\n            }\r\n\r\n        }\r\n        \r\n        loadData();\r\n\r\n    }, [docCollection, search, uid, cancelled]);\r\n\r\n    useEffect(() => {\r\n        return () => setCancelled(true);\r\n    }, []);\r\n    \r\n    return { documents, loading, error };\r\n};"],"mappings":"usBAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,OAASC,EAAT,KAAmB,oBAAnB,CACA,OACIC,UADJ,CAEIC,KAFJ,CAGIC,OAHJ,CAIIC,UAJJ,CAKIC,KALJ,KAMO,oBANP,CASA,MAAO,IAAMC,kBAAiB,CAAG,QAApBA,kBAAoB,CAACC,aAAD,CAA8C,IAA9BC,OAA8B,2DAArB,IAAqB,IAAfC,IAAe,2DAAT,IAAS,CAE3E,cAAkCX,QAAQ,CAAC,IAAD,CAA1C,wCAAOY,SAAP,eAAkBC,YAAlB,eACA,eAA0Bb,QAAQ,CAAC,IAAD,CAAlC,yCAAOc,KAAP,eAAcC,QAAd,eACA,eAA8Bf,QAAQ,CAAC,IAAD,CAAtC,yCAAOgB,OAAP,eAAgBC,UAAhB,eAGA;AACA,eAAkCjB,QAAQ,CAAC,KAAD,CAA1C,yCAAOkB,SAAP,eAAkBC,YAAlB,eAEAlB,SAAS,CAAC,UAAM,SAEGmB,SAFH,oIAEZ,6JACOF,SADP,iEAGID,UAAU,CAAC,IAAD,CAAV,CAHJ,sBAKgCd,WAAU,CAACD,EAAD,CAAKO,aAAL,CAL1C,QAKUY,aALV,mCAYWX,MAZX,iDAasBN,MAAK,CAACiB,aAAD,CAAgBd,KAAK,CAAC,WAAD,CAAc,gBAAd,CAAgCG,MAAhC,CAArB,CAA8DL,OAAO,CAAC,WAAD,CAAc,MAAd,CAArE,CAb3B,SAaYiB,CAbZ,kDAgBkBX,GAhBlB,iDAiBsBP,MAAK,CAACiB,aAAD,CAAgBd,KAAK,CAAC,KAAD,CAAQ,IAAR,CAAcI,GAAd,CAArB,CAAyCN,OAAO,CAAC,WAAD,CAAc,MAAd,CAAhD,CAjB3B,SAiBYiB,CAjBZ,qEAoBsBlB,MAAK,CAACiB,aAAD,CAAgBhB,OAAO,CAAC,WAAD,CAAc,MAAd,CAAvB,CApB3B,SAoBYiB,CApBZ,8CAuBchB,WAAU,CAACgB,CAAD,CAAI,SAACC,aAAD,CAAmB,CAEnCV,YAAY,CACRU,aAAa,CAACC,IAAd,CAAmBC,GAAnB,CAAuB,SAACC,GAAD,wBACnBC,EAAE,CAAED,GAAG,CAACC,EADW,EAEhBD,GAAG,CAACE,IAAJ,EAFgB,GAAvB,CADQ,CAAZ,CAMH,CARe,CAvBxB,SAiCQX,UAAU,CAAC,KAAD,CAAV,CAjCR,iFAmCQY,OAAO,CAACC,GAAR,cACAf,QAAQ,CAAC,YAAMgB,OAAP,CAAR,CAEAd,UAAU,CAAC,KAAD,CAAV,CAtCR,qEAFY,2CA6CZG,QAAQ,GAEX,CA/CQ,CA+CN,CAACX,aAAD,CAAgBC,MAAhB,CAAwBC,GAAxB,CAA6BO,SAA7B,CA/CM,CAAT,CAiDAjB,SAAS,CAAC,UAAM,CACZ,MAAO,kBAAMkB,aAAY,CAAC,IAAD,CAAlB,EAAP,CACH,CAFQ,CAEN,EAFM,CAAT,CAIA,MAAO,CAAEP,SAAS,CAATA,SAAF,CAAaI,OAAO,CAAPA,OAAb,CAAsBF,KAAK,CAALA,KAAtB,CAAP,CACH,CAhEM"},"metadata":{},"sourceType":"module"}