{"ast":null,"code":"import _regeneratorRuntime from\"C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/10-miniblog/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/10-miniblog/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/10-miniblog/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,useReducer}from'react';import{db}from'../firebase/config';import{updateDoc,doc}from'firebase/firestore';var initialState={loading:null,error:null};var updateReducer=function updateReducer(state,action){switch(action.type){case\"LOADING\":return{loading:true,error:null};case\"UPDATED_DOC\":return{loading:false,error:null};case\"ERROR\":return{loading:false,error:action.payload};default:return state;}};export var useUpdateDocument=function useUpdateDocument(docCollection){var _useReducer=useReducer(updateReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),response=_useReducer2[0],dispatch=_useReducer2[1];// deal with memory leak\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),cancelled=_useState2[0],setCancelled=_useState2[1];var checkCancelBeforeDispatch=function checkCancelBeforeDispatch(action){if(!cancelled){dispatch(action);}};var updateDocument=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(id,data){var docRef,updatedDocument;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:checkCancelBeforeDispatch({type:\"LOADING\"});_context.prev=1;_context.next=4;return doc(db,docCollection,id);case 4:docRef=_context.sent;_context.next=7;return updateDoc(docRef,data);case 7:updatedDocument=_context.sent;checkCancelBeforeDispatch({type:\"UPDATED_DOC\",payload:updatedDocument});_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](1);checkCancelBeforeDispatch({type:\"ERROR\",payload:_context.t0.message});case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,11]]);}));return function updateDocument(_x,_x2){return _ref.apply(this,arguments);};}();useEffect(function(){return function(){return setCancelled(true);};},[]);return{updateDocument:updateDocument,response:response};};","map":{"version":3,"names":["useState","useEffect","useReducer","db","updateDoc","doc","initialState","loading","error","updateReducer","state","action","type","payload","useUpdateDocument","docCollection","response","dispatch","cancelled","setCancelled","checkCancelBeforeDispatch","updateDocument","id","data","docRef","updatedDocument","message"],"sources":["C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/10-miniblog/src/hooks/useUpdateDocument.js"],"sourcesContent":["import {useState, useEffect, useReducer} from 'react';\r\nimport {db} from '../firebase/config';\r\nimport { updateDoc, doc } from 'firebase/firestore';\r\n\r\n\r\nconst initialState = {\r\n    loading: null,\r\n    error: null\r\n};\r\n\r\nconst updateReducer = (state, action) => {\r\n    switch(action.type) {\r\n\r\n        case \"LOADING\":\r\n            return {loading: true, error: null};\r\n        case \"UPDATED_DOC\":\r\n            return {loading: false, error: null};\r\n        case \"ERROR\":\r\n            return {loading: false, error: action.payload};\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n\r\nexport const useUpdateDocument = (docCollection) => {\r\n\r\n    const [response, dispatch] = useReducer(updateReducer, initialState);\r\n\r\n    // deal with memory leak\r\n    const [cancelled, setCancelled] = useState(false);\r\n\r\n    const checkCancelBeforeDispatch = (action) => {\r\n        if(!cancelled) {\r\n            dispatch(action);\r\n        }\r\n    };\r\n\r\n    const updateDocument = async(id, data) => {\r\n        checkCancelBeforeDispatch({\r\n            type: \"LOADING\",\r\n        });\r\n\r\n        try {\r\n\r\n            const docRef = await doc(db, docCollection, id);\r\n\r\n            const updatedDocument = await updateDoc(docRef, data);\r\n            \r\n            checkCancelBeforeDispatch({\r\n                type: \"UPDATED_DOC\",\r\n                payload: updatedDocument,\r\n            });\r\n\r\n        } catch (error) {\r\n\r\n            checkCancelBeforeDispatch({\r\n                type: \"ERROR\",\r\n                payload: error.message,\r\n            });\r\n            \r\n        }\r\n\r\n    };\r\n\r\n    useEffect(() => {\r\n        return () => setCancelled(true);\r\n    }, []);\r\n\r\n    return{updateDocument, response};\r\n};"],"mappings":"miBAAA,OAAQA,QAAR,CAAkBC,SAAlB,CAA6BC,UAA7B,KAA8C,OAA9C,CACA,OAAQC,EAAR,KAAiB,oBAAjB,CACA,OAASC,SAAT,CAAoBC,GAApB,KAA+B,oBAA/B,CAGA,GAAMC,aAAY,CAAG,CACjBC,OAAO,CAAE,IADQ,CAEjBC,KAAK,CAAE,IAFU,CAArB,CAKA,GAAMC,cAAa,CAAG,QAAhBA,cAAgB,CAACC,KAAD,CAAQC,MAAR,CAAmB,CACrC,OAAOA,MAAM,CAACC,IAAd,EAEI,IAAK,SAAL,CACI,MAAO,CAACL,OAAO,CAAE,IAAV,CAAgBC,KAAK,CAAE,IAAvB,CAAP,CACJ,IAAK,aAAL,CACI,MAAO,CAACD,OAAO,CAAE,KAAV,CAAiBC,KAAK,CAAE,IAAxB,CAAP,CACJ,IAAK,OAAL,CACI,MAAO,CAACD,OAAO,CAAE,KAAV,CAAiBC,KAAK,CAAEG,MAAM,CAACE,OAA/B,CAAP,CACJ,QACI,MAAOH,MAAP,CATR,CAWH,CAZD,CAcA,MAAO,IAAMI,kBAAiB,CAAG,QAApBA,kBAAoB,CAACC,aAAD,CAAmB,CAEhD,gBAA6Bb,UAAU,CAACO,aAAD,CAAgBH,YAAhB,CAAvC,4CAAOU,QAAP,iBAAiBC,QAAjB,iBAEA;AACA,cAAkCjB,QAAQ,CAAC,KAAD,CAA1C,wCAAOkB,SAAP,eAAkBC,YAAlB,eAEA,GAAMC,0BAAyB,CAAG,QAA5BA,0BAA4B,CAACT,MAAD,CAAY,CAC1C,GAAG,CAACO,SAAJ,CAAe,CACXD,QAAQ,CAACN,MAAD,CAAR,CACH,CACJ,CAJD,CAMA,GAAMU,eAAc,4FAAG,iBAAMC,EAAN,CAAUC,IAAV,+IACnBH,yBAAyB,CAAC,CACtBR,IAAI,CAAE,SADgB,CAAD,CAAzB,CADmB,sCAOMP,IAAG,CAACF,EAAD,CAAKY,aAAL,CAAoBO,EAApB,CAPT,QAOTE,MAPS,qCASepB,UAAS,CAACoB,MAAD,CAASD,IAAT,CATxB,QASTE,eATS,eAWfL,yBAAyB,CAAC,CACtBR,IAAI,CAAE,aADgB,CAEtBC,OAAO,CAAEY,eAFa,CAAD,CAAzB,CAXe,iFAkBfL,yBAAyB,CAAC,CACtBR,IAAI,CAAE,OADgB,CAEtBC,OAAO,CAAE,YAAMa,OAFO,CAAD,CAAzB,CAlBe,qEAAH,kBAAdL,eAAc,gDAApB,CA2BApB,SAAS,CAAC,UAAM,CACZ,MAAO,kBAAMkB,aAAY,CAAC,IAAD,CAAlB,EAAP,CACH,CAFQ,CAEN,EAFM,CAAT,CAIA,MAAM,CAACE,cAAc,CAAdA,cAAD,CAAiBL,QAAQ,CAARA,QAAjB,CAAN,CACH,CA7CM"},"metadata":{},"sourceType":"module"}