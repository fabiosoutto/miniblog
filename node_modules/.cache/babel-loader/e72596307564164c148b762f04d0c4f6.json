{"ast":null,"code":"import _regeneratorRuntime from\"C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/10-miniblog/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/10-miniblog/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/10-miniblog/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/10-miniblog/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,useReducer}from'react';import{db}from'../firebase/config';import{collection,addDoc,Timestamp}from'firebase/firestore';var initialState={loading:null,error:null};var insertReducer=function insertReducer(state,action){switch(action.type){case\"LOADING\":return{loading:true,error:null};case\"INSERTED_DOC\":return{loading:false,error:null};case\"ERROR\":return{loading:false,error:action.payload};default:return state;}};export var useInsertDocument=function useInsertDocument(docCollection){var _useReducer=useReducer(insertReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),response=_useReducer2[0],dispatch=_useReducer2[1];// deal with memory leak\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),cancelled=_useState2[0],setCancelled=_useState2[1];var checkCancelBeforeDispatch=function checkCancelBeforeDispatch(action){if(!cancelled){dispatch(action);}};var insertDocument=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(document){var newDocument,_insertDocument;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:checkCancelBeforeDispatch({type:\"LOADING\"});_context.prev=1;newDocument=_objectSpread(_objectSpread({},document),{},{createdAt:Timestamp.now()});_context.next=5;return addDoc(collection(db,docCollection),newDocument);case 5:_insertDocument=_context.sent;checkCancelBeforeDispatch({type:\"INSERTED_DOC\",payload:_insertDocument});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);checkCancelBeforeDispatch({type:\"ERROR\",payload:_context.t0.message});case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);}));return function insertDocument(_x){return _ref.apply(this,arguments);};}();useEffect(function(){return function(){return setCancelled(true);};},[]);return{insertDocument:insertDocument,response:response};};","map":{"version":3,"names":["useState","useEffect","useReducer","db","collection","addDoc","Timestamp","initialState","loading","error","insertReducer","state","action","type","payload","useInsertDocument","docCollection","response","dispatch","cancelled","setCancelled","checkCancelBeforeDispatch","insertDocument","document","newDocument","createdAt","now","message"],"sources":["C:/xampp/htdocs/Curso ReactJS/Curso ReactJS - Matheus Battisti/Projetos ReactJS/10-miniblog/src/hooks/useInsertDocument.js"],"sourcesContent":["import {useState, useEffect, useReducer} from 'react';\r\nimport {db} from '../firebase/config';\r\nimport { collection, addDoc, Timestamp } from 'firebase/firestore';\r\n\r\n\r\nconst initialState = {\r\n    loading: null,\r\n    error: null\r\n};\r\n\r\nconst insertReducer = (state, action) => {\r\n    switch(action.type) {\r\n\r\n        case \"LOADING\":\r\n            return {loading: true, error: null};\r\n        case \"INSERTED_DOC\":\r\n            return {loading: false, error: null};\r\n        case \"ERROR\":\r\n            return {loading: false, error: action.payload};\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n\r\nexport const useInsertDocument = (docCollection) => {\r\n\r\n    const [response, dispatch] = useReducer(insertReducer, initialState);\r\n\r\n    // deal with memory leak\r\n    const [cancelled, setCancelled] = useState(false);\r\n\r\n    const checkCancelBeforeDispatch = (action) => {\r\n        if(!cancelled) {\r\n            dispatch(action);\r\n        }\r\n    };\r\n\r\n    const insertDocument = async(document) => {\r\n        checkCancelBeforeDispatch({\r\n            type: \"LOADING\",\r\n        });\r\n\r\n        try {\r\n            \r\n            const newDocument = {...document, createdAt: Timestamp.now()}\r\n\r\n            const insertDocument = await addDoc(\r\n                collection(db, docCollection),\r\n                newDocument\r\n            )\r\n\r\n            checkCancelBeforeDispatch({\r\n                type: \"INSERTED_DOC\",\r\n                payload: insertDocument\r\n            });\r\n\r\n        } catch (error) {\r\n\r\n            checkCancelBeforeDispatch({\r\n                type: \"ERROR\",\r\n                payload: error.message,\r\n            });\r\n            \r\n        }\r\n\r\n    };\r\n\r\n    useEffect(() => {\r\n        return () => setCancelled(true);\r\n    }, []);\r\n\r\n    return{insertDocument, response};\r\n};"],"mappings":"mtBAAA,OAAQA,QAAR,CAAkBC,SAAlB,CAA6BC,UAA7B,KAA8C,OAA9C,CACA,OAAQC,EAAR,KAAiB,oBAAjB,CACA,OAASC,UAAT,CAAqBC,MAArB,CAA6BC,SAA7B,KAA8C,oBAA9C,CAGA,GAAMC,aAAY,CAAG,CACjBC,OAAO,CAAE,IADQ,CAEjBC,KAAK,CAAE,IAFU,CAArB,CAKA,GAAMC,cAAa,CAAG,QAAhBA,cAAgB,CAACC,KAAD,CAAQC,MAAR,CAAmB,CACrC,OAAOA,MAAM,CAACC,IAAd,EAEI,IAAK,SAAL,CACI,MAAO,CAACL,OAAO,CAAE,IAAV,CAAgBC,KAAK,CAAE,IAAvB,CAAP,CACJ,IAAK,cAAL,CACI,MAAO,CAACD,OAAO,CAAE,KAAV,CAAiBC,KAAK,CAAE,IAAxB,CAAP,CACJ,IAAK,OAAL,CACI,MAAO,CAACD,OAAO,CAAE,KAAV,CAAiBC,KAAK,CAAEG,MAAM,CAACE,OAA/B,CAAP,CACJ,QACI,MAAOH,MAAP,CATR,CAWH,CAZD,CAcA,MAAO,IAAMI,kBAAiB,CAAG,QAApBA,kBAAoB,CAACC,aAAD,CAAmB,CAEhD,gBAA6Bd,UAAU,CAACQ,aAAD,CAAgBH,YAAhB,CAAvC,4CAAOU,QAAP,iBAAiBC,QAAjB,iBAEA;AACA,cAAkClB,QAAQ,CAAC,KAAD,CAA1C,wCAAOmB,SAAP,eAAkBC,YAAlB,eAEA,GAAMC,0BAAyB,CAAG,QAA5BA,0BAA4B,CAACT,MAAD,CAAY,CAC1C,GAAG,CAACO,SAAJ,CAAe,CACXD,QAAQ,CAACN,MAAD,CAAR,CACH,CACJ,CAJD,CAMA,GAAMU,eAAc,4FAAG,iBAAMC,QAAN,oJACnBF,yBAAyB,CAAC,CACtBR,IAAI,CAAE,SADgB,CAAD,CAAzB,CADmB,gBAOTW,WAPS,gCAOSD,QAPT,MAOmBE,SAAS,CAAEnB,SAAS,CAACoB,GAAV,EAP9B,yBAScrB,OAAM,CAC/BD,UAAU,CAACD,EAAD,CAAKa,aAAL,CADqB,CAE/BQ,WAF+B,CATpB,QASTF,eATS,eAcfD,yBAAyB,CAAC,CACtBR,IAAI,CAAE,cADgB,CAEtBC,OAAO,CAAEQ,eAFa,CAAD,CAAzB,CAde,+EAqBfD,yBAAyB,CAAC,CACtBR,IAAI,CAAE,OADgB,CAEtBC,OAAO,CAAE,YAAMa,OAFO,CAAD,CAAzB,CArBe,oEAAH,kBAAdL,eAAc,4CAApB,CA8BArB,SAAS,CAAC,UAAM,CACZ,MAAO,kBAAMmB,aAAY,CAAC,IAAD,CAAlB,EAAP,CACH,CAFQ,CAEN,EAFM,CAAT,CAIA,MAAM,CAACE,cAAc,CAAdA,cAAD,CAAiBL,QAAQ,CAARA,QAAjB,CAAN,CACH,CAhDM"},"metadata":{},"sourceType":"module"}